---
layout: post
read_time: true
show_date: true
title:  Git 多密钥配置和多平台托管
date:   2021-05-08 13:32:20 -0600
description: 
img: posts/git.png
tags: [Oracle]
author: Armando Maynez
github:  amaynez/Perceptron/
mathjax: yes
toc: yes
---

[出处](https://blog.csdn.net/weixin_44171004/article/details/116697799)，亲测可用。

# 1. 多密钥配置

## 1.1 生成密钥

如果是 Windows 系统，建议使用安装 Git 时自带的 `git bash` 终端。

```bash
ssh-keygen -t rsa -C "lime2019@foxmail.com" -f ~/.ssh/id_rsa_gitee
ssh-keygen -t rsa -C "lime2019@foxmail.com" -f ~/.ssh/id_rsa_github
```

## 1.2 添加密钥到 ssh-agent 中

Git 默认读取的文件文件名为 `id_rsa`，因此我们需要将生成的密钥添加到 `ssh-agent` 中。

```bash
# 添加密钥地址到ssh-agent
ssh-add ~/.ssh/id_rsa_github
ssh-add ~/.ssh/id_rsa_gitee
# 如果出错，可以使用这条命令，再执行上方代码
ssh-agent bash
```

## 1.3 编写配置文件

编写 config 文件（`~/.ssh`目录下），若没有则自行新建。

```bash
# github
Host github.com
HostName github.com
PreferredAuthentications publickey  
IdentityFile ~/.ssh/id_rsa_github  
# gitee
Host gitee.com
HostName gitee.com
PreferredAuthentications publickey  
IdentityFile ~/.ssh/id_rsa_gitee
# 相关参数
# Host：对识别的模式，进行配置对应的主机名和ssh文件
# HostName ： 登录主机的主机名
# PreferredAuthentications ：设置登录方式（publickey为使用密钥登录，password为使用密码登录）
# IdentityFile ：私钥全路径名
```

## 1.4 将公钥添加到 Github 和 Gitee SSH 设置中

## 1.5 测试是否添加成功

```bash
ssh -T git@github.com
ssh -T gitee@github.com
```

测试完成后，如果上传代码出现被拒绝，建议先重启电脑。

# 2. 多平台托管

## 2.1 一个项目同时托管在 Gitee 和 Github 上

这里选用一个已经托管到 Gitee上项目进行演示。

将其关联到 Github 仓库（已创建）上：

```bash
# 添加名为github的远程仓库
git remote add github git@github.com:lime2019/purble-pairs.git
# 查看当前远程信息，默认远程名称为origin
git remote -v
# 删除一个远程
git remote rm origin
```

## 2.2 项目推送

项目代码修改完成后，推送到远端，则：

```bash
# 向github推送
git push github main
# 向Gitee推送
git push gitee main
```

## 2.3 使用脚本

虽然按照上面操作，我们实现了，一个项目托管在两个平台上，但是每一次推送都得输两次推送命令，有点麻烦。所以，可以编写脚本实现一条命令同时向两个托管平台推送代码。

在项目目录下新建 `deploy.sh`

```bash
#!/usr/bin/env sh

# 确保脚本抛出遇到的错误
set -e

# git操作
git add .
git commit -m 'deploy'

git push github main

git push gitee main
```

然后在终端中直接运行 `./deploy.sh` 即可。
